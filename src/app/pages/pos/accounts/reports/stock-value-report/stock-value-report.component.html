<section class="page-header-section">
  <div class="page-header-card">
    <div class="header-content">
      <div class="header-title">
        <h1 class="page-title">
          <mat-icon class="title-icon">warehouse</mat-icon>
          Stock Value Report
        </h1>
      </div>
    </div>
  </div>
</section>

<section class="summary-section" *ngIf="stockData?.summary">
  <div class="summary-cards">
    <div class="summary-card highlight">
      <h3>Total Stock Value</h3>
      <p class="amount">{{ stockData.summary.totalStockValue | currency:'BDT ':'symbol':'1.2-2' }}</p>
    </div>
    <div class="summary-card">
      <h3>Total Quantity</h3>
      <p class="amount">{{ stockData.summary.totalQuantity }}</p>
    </div>
    <div class="summary-card">
      <h3>Total Products</h3>
      <p class="amount">{{ stockData.summary.totalProducts }}</p>
    </div>
  </div>
</section>

<section class="filter-section" *ngIf="!isLoading && stockData">
  <div class="filter-card">
    <div class="search-container">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search Products</mat-label>
        <input
          matInput
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange()"
          placeholder="Search by product name, SKU, or category..."
          autocomplete="off">
        <mat-icon matPrefix>search</mat-icon>
        <button
          mat-icon-button
          matSuffix
          *ngIf="searchTerm"
          (click)="clearSearch()"
          aria-label="Clear search">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <div class="export-toolbar">
      <button
        mat-stroked-button
        class="export-btn"
        (click)="exportCSV()"
        matTooltip="Export CSV">
        <mat-icon>description</mat-icon>
        <span>Export CSV</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="exportExcel()"
        matTooltip="Export Excel">
        <mat-icon>table_chart</mat-icon>
        <span>Export Excel</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="printReport()"
        matTooltip="Print">
        <mat-icon>print</mat-icon>
        <span>Print</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="showColumnsInfo()"
        matTooltip="Columns">
        <mat-icon>view_column</mat-icon>
        <span>Columns</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="exportPDF()"
        matTooltip="Export PDF">
        <mat-icon>picture_as_pdf</mat-icon>
        <span>Export PDF</span>
      </button>
    </div>
  </div>
</section>

<app-page-loader *ngIf="isLoading"></app-page-loader>

<section class="content-section" *ngIf="!isLoading && stockData">
  <div class="report-card" *ngIf="stockData.categorySummary && stockData.categorySummary.length > 0">
    <h2>Category Wise Summary</h2>
    <div class="table-responsive">
      <table class="modern-table">
        <thead>
          <tr>
            <th>Category</th>
            <th>Total Quantity</th>
            <th>Total Stock Value</th>
            <th>Product Count</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let category of stockData.categorySummary" class="table-row">
            <td>{{ category.categoryName || 'N/A' }}</td>
            <td>{{ category.totalQuantity || 0 }}</td>
            <td><strong>{{ category.totalStockValue | currency:'BDT ':'symbol':'1.2-2' }}</strong></td>
            <td>{{ category.productCount }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="report-card" *ngIf="stockData.products && stockData.products.length > 0">
    <h2>Product Details</h2>
    <div class="table-responsive">
      <table class="modern-table">
        <thead>
          <tr>
            <th>Product Name</th>
            <th>SKU</th>
            <th>Category</th>
            <th>Quantity</th>
            <th>Purchase Price</th>
            <th>Sale Price</th>
            <th>Stock Value</th>
            <th>Potential Value</th>
            <th>Profit Potential</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of stockData.products" class="table-row">
            <td>{{ product.productName || 'N/A' }}</td>
            <td>{{ product.sku || '-' }}</td>
            <td>{{ product.category || '-' }}</td>
            <td>{{ product.quantity || 0 }}</td>
            <td>{{ product.purchasePrice | currency:'BDT ':'symbol':'1.2-2' }}</td>
            <td>{{ product.salePrice | currency:'BDT ':'symbol':'1.2-2' }}</td>
            <td><strong>{{ product.stockValue | currency:'BDT ':'symbol':'1.2-2' }}</strong></td>
            <td>{{ product.potentialValue | currency:'BDT ':'symbol':'1.2-2' }}</td>
            <td [ngClass]="{'positive': product.profitPotential >= 0, 'negative': product.profitPotential < 0}">
              {{ product.profitPotential | currency:'BDT ':'symbol':'1.2-2' }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<app-no-content *ngIf="!isLoading && (!stockData?.products || stockData.products.length === 0)" [text]="'No stock data found'"></app-no-content>

